<%- include('partials/head') %>
<%- include('partials/nav') %>

<div class="container mx-auto mt-10">
  <h2 class="text-2xl font-bold mb-6">Admin - All Submissions</h2>

  <input 
    type="text" 
    id="searchBox" 
    placeholder="Search..." 
    class="p-2 border w-full mb-4"
  >

  <table class="min-w-full bg-white border" id="donationsTable">
    <thead>
      <tr class="bg-gray-200">
        <th class="py-2 px-4 border">Full Name</th>
        <th class="py-2 px-4 border">Address</th>
        <th class="py-2 px-4 border">Mobile</th>
        <th class="py-2 px-4 border">Email</th>
        <th class="py-2 px-4 border">Amount (INR)</th>
        <th class="py-2 px-4 border">Comment</th>
        <th class="py-2 px-4 border">Payment Method</th>
        <th class="py-2 px-4 border">Date & Time</th>
        <th class="py-2 px-4 border">Receipt</th>
      </tr>
    </thead>
    <tbody>
      <% donations.forEach(donation => { %>
      <tr>
        <td class="py-2 px-4 border"><%= donation.fullName %></td>
        <td class="py-2 px-4 border"><%= donation.address %></td>
        <td class="py-2 px-4 border"><%= donation.mobile %></td>
        <td class="py-2 px-4 border"><%= donation.email %></td>
        <td class="py-2 px-4 border"><%= donation.amountINR %></td>
        <td class="py-2 px-4 border"><%= donation.comment || '' %></td>
        <td class="py-2 px-4 border"><%= donation.paymentMethod || '' %></td>
        <td class="py-2 px-4 border"><%= donation.date ? donation.date.toLocaleString() : '' %></td>
        <td class="py-2 px-4 border">
          <a href="/receipt/<%= donation._id %>" class="bg-blue-500 text-white px-3 py-1 rounded">View</a>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<script>
  // Get references
  const searchBox = document.getElementById("searchBox");
  const table = document.getElementById("donationsTable").getElementsByTagName("tbody")[0];

  searchBox.addEventListener("keyup", function() {
    const filter = searchBox.value.toLowerCase();
    const rows = table.getElementsByTagName("tr");

    for (let i = 0; i < rows.length; i++) {
      let rowText = rows[i].innerText.toLowerCase();
      if (rowText.includes(filter)) {
        rows[i].style.display = "";
      } else {
        rows[i].style.display = "none";
      }
    }
  });
</script>

</body>
</html>
